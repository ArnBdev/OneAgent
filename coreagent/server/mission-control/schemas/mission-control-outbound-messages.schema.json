{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://oneagent.dev/schemas/mission-control-outbound-messages.json",
  "title": "Mission Control Outbound Messages",
  "oneOf": [
    {
      "type": "object",
      "required": ["type", "id", "timestamp", "server"],
      "properties": { "type": { "const": "heartbeat" }, "server": { "type": "object" } },
      "additionalProperties": true
    },
    {
      "type": "object",
      "required": ["type", "id", "timestamp", "server"],
      "properties": { "type": { "const": "pong" }, "server": { "type": "object" } },
      "additionalProperties": true
    },
    {
      "type": "object",
      "required": ["type", "id", "timestamp", "server", "payload"],
      "properties": {
        "type": { "const": "whoami" },
        "payload": {
          "type": "object",
          "required": ["server", "version", "channels"],
          "properties": {
            "server": { "type": "string" },
            "version": { "type": "string" },
            "channels": { "type": "array", "items": { "type": "string" } }
          }
        }
      },
      "additionalProperties": true
    },
    {
      "type": "object",
      "required": ["type", "id", "timestamp", "server", "payload"],
      "properties": {
        "type": { "const": "subscription_ack" },
        "payload": {
          "type": "object",
          "required": ["channel", "status"],
          "properties": {
            "channel": { "type": "string" },
            "status": { "enum": ["subscribed", "unsubscribed"] }
          }
        }
      },
      "additionalProperties": true
    },
    {
      "type": "object",
      "required": ["type", "id", "timestamp", "server", "error"],
      "properties": {
        "type": { "const": "subscription_error" },
        "error": {
          "type": "object",
          "required": ["code", "message"],
          "properties": { "code": { "type": "string" }, "message": { "type": "string" } }
        }
      },
      "additionalProperties": true
    },
    {
      "type": "object",
      "required": ["type", "id", "timestamp", "server", "error"],
      "properties": { "type": { "const": "protocol_error" }, "error": { "type": "object" } },
      "additionalProperties": true
    },
    {
      "type": "object",
      "required": ["type", "id", "timestamp", "server", "payload"],
      "properties": {
        "type": { "const": "health_delta" },
        "payload": {
          "type": "object",
          "required": ["status"],
          "properties": { "status": { "type": "string" } },
          "additionalProperties": true
        }
      },
      "additionalProperties": true
    },
    {
      "type": "object",
      "required": ["type", "id", "timestamp", "server", "payload"],
      "properties": {
        "type": { "const": "metrics_tick" },
        "payload": {
          "type": "object",
          "properties": {
            "p95": { "type": ["number", "null"] },
            "p99": { "type": ["number", "null"] }
          },
          "additionalProperties": true
        }
      },
      "additionalProperties": true
    },
    {
      "type": "object",
      "required": ["type", "id", "timestamp", "server", "payload"],
      "properties": {
        "type": { "const": "mission_ack" },
        "payload": {
          "type": "object",
          "required": ["missionId", "status"],
          "properties": { "missionId": { "type": "string" }, "status": { "const": "accepted" } }
        }
      },
      "additionalProperties": true
    },
    {
      "type": "object",
      "required": ["type", "id", "timestamp", "server", "payload"],
      "properties": {
        "type": { "const": "mission_update" },
        "payload": {
          "type": "object",
          "required": ["missionId", "status"],
          "properties": {
            "missionId": { "type": "string" },
            "status": {
              "enum": [
                "planning_started",
                "tasks_generated",
                "planned",
                "execution_started",
                "execution_progress",
                "completed",
                "cancelled",
                "error"
              ]
            },
            "error": { "type": ["string", "null"], "nullable": true }
          },
          "additionalProperties": true
        }
      },
      "additionalProperties": true
    },
    {
      "type": "object",
      "required": ["type", "id", "timestamp", "server", "payload"],
      "properties": {
        "type": { "const": "mission_stats" },
        "payload": {
          "type": "object",
          "required": ["snapshotId", "active", "completed"],
          "properties": {
            "snapshotId": { "type": "string" },
            "active": { "type": "number" },
            "completed": { "type": "number" },
            "avgDurationMs": { "type": ["number", "null"] },
            "cancelled": { "type": ["number", "null"] },
            "errors": { "type": ["number", "null"] }
          },
          "additionalProperties": true
        }
      },
      "additionalProperties": true
    }
  ]
}
